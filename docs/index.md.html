**Scientific cluster**

Introduction
============

`Scientific cluster` provides a virtual simulation on a cluster based on
[LUSTRE](http://lustre.org) (a open-source parallel file system used in HPC) and [SLURM](https://slurm.schedmd.com) (a open-source fault-tolerant cluster
management system). This is arguably the most common architecture used in
scientific computer clusters.

The virtual simulation runs on top of [QEMU](http://www.qemu.org).

The main purpose of this package is to allow administrators of scientific
clusters to test different configurations before deployment.

In the near future we will also support [Singularity](http://singularity.lbl.gov/index.html) (A user managed container system allowing the deployment of
complex workloads on a cluster).

There might be other components included (for example, OpenLDAP and NFS).

Requirements
============

- An OS that can run QEMU. This was tested on Linux as a host
  environment.  We suspect that it will almost "out of the box" on a
  Mac and it will need some work on Windows
- QEMU
- 12 GB of memory
- sshpass
- bash
- ~30 GB of free disk space
- root access

Optional:

- VNC client

Architecture
============

![Cluster architecture](cluster.png)

Installation
============

## Creation of a base image


### Step 1

The first issue is the creation of a base image that will be used to
create all other images:

The steps are:

- Download the ISO for Ubuntu Server 16.04
- Patch the ISO to auto-install
- Create a virtual disk
- Run the patched ISO to create the base image

Run the script `create_base_image.sh`. Note that it will create a
**password-less** VNC interface on *:1 .

This will take a lot of time to run. Connect to the VNC interface as
soon as it is up to monitor the progress. Kill the script as soon as there
machine reboots, after clicking continue here:

![Install finish](install_finish.png)

Wait for the machine to reboot and kill QEMU (do not let it boot).

The machine has SSH and the root password is test. We will take care of
security in step 2.

### Step 2

Now you have `pre-base.img`. Copy this to `base.img` and `backup.img`.
The backup image will be useful if you have problems from now on.

The base image will be patched to allow public/private key login instead of
password.

Start the base image with:

```bash
qemu-system-x86_64 -m 1G -drive file=pre-base.img,format=raw -vnc :1 -net nic,macaddr=52:54:00:12:34:56 -net socket,listen=:1234 -net user,hostfwd=tcp:127.0.0.1:22222-:22
```

Test the connection with `ssh -p22222 root@localhost`. The password is
test. Note that the VM might take some time to start.

Run `scripts/prepare_security.sh`. Give it some time to halt (or check
on VNC). Shutdown QEMU.


Example configuration
=====================


(add bioconda also)


FAQ
===

## Why not Docker?

LUSTRE requires access to block volumes.

Contact
=======


<style class="fallback">body{visibility:hidden;white-space:pre;font-family:monospace}</style>

<script src="https://casual-effects.com/markdeep/latest/markdeep.min.js"></script>

<script>window.alreadyProcessedMarkdeep||(document.body.style.visibility="visible")</script>
